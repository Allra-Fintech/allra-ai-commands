# PR 생성 전 코드 리뷰

PR을 생성하기 전에 현재 변경사항을 사전 검토하는 1차 셀프 리뷰 커맨드입니다.
잠재적 이슈를 미리 발견하고 수정하여 코드 품질을 높일 수 있습니다.

## 인자
- `$ARGUMENTS`: 없음

## 워크플로우

### 1단계: 변경사항 수집
- `git status`로 변경된 파일 목록 확인
- `git diff`로 전체 변경 내용 상세 분석
- 스테이징된 파일과 스테이징되지 않은 파일 모두 포함

### 2단계: 코드 품질 분석
다음 항목들을 중점적으로 검토:

#### 버그 가능성
- Null/Undefined 체크 누락
- 배열 인덱스 범위 초과
- 무한 루프 가능성
- 예외 처리 누락
- 논리 오류 (조건문, 반복문)

#### 보안 취약점
- SQL Injection 가능성
- XSS 취약점
- 인증/권한 체크 누락
- 민감정보 하드코딩
- 안전하지 않은 API 호출

#### 성능 이슈
- N+1 쿼리 문제
- 불필요한 반복문
- 메모리 누수 가능성
- 비효율적인 알고리즘
- 캐싱 기회 누락

#### 코드 스타일 & 가독성
- 네이밍 일관성
- 과도하게 긴 함수/메서드
- 중복 코드
- 주석 필요 여부
- 코드 복잡도

#### 테스트
- 테스트 코드 누락 여부
- 엣지 케이스 테스트 필요성
- 테스트 커버리지 확인

#### 비즈니스 로직
- 요구사항 충족 여부
- 데이터 정합성
- 트랜잭션 처리
- 에러 핸들링 적절성

### 3단계: 리뷰 결과 보고

다음 형식으로 분석 결과를 정리하여 사용자에게 보여주기:

```
## 코드 리뷰 결과

### 🔴 Critical (즉시 수정 필요) - {n}건
| 파일 | 라인 | 이슈 | 설명 | 수정 방안 |
|------|------|------|------|----------|
| UserService.java | 42 | Null 체크 누락 | user 객체 null 가능성 | Optional 또는 null 체크 추가 |
| ... | ... | ... | ... | ... |

### 🟡 Warning (권장 수정) - {m}건
| 파일 | 라인 | 이슈 | 설명 | 수정 방안 |
|------|------|------|------|----------|
| OrderController.java | 80 | N+1 쿼리 | 반복문 내 DB 호출 | fetch join 또는 batch 사용 |
| ... | ... | ... | ... | ... |

### 🔵 Info (개선 제안) - {k}건
| 파일 | 라인 | 이슈 | 설명 | 수정 방안 |
|------|------|------|------|----------|
| PaymentService.java | 120 | 네이밍 개선 | 변수명이 모호함 | data → paymentRequest |
| ... | ... | ... | ... | ... |

### ✅ 테스트 누락 - {p}건
| 파일 | 설명 | 필요한 테스트 |
|------|------|--------------|
| UserService.java | 신규 메서드 추가 | 단위 테스트 작성 |
| ... | ... | ... |

### 총 {n+m+k+p}건의 리뷰 포인트 발견
```

**반드시 사용자에게 확인받기:**
- Critical 이슈는 반드시 수정할 것인지
- Warning/Info 중 어떤 것을 수정할 것인지
- 테스트 코드를 지금 작성할 것인지

### 4단계: 이슈 수정
- 사용자가 선택한 이슈들을 순차적으로 수정
- 각 수정 후 간단히 검토
- 수정 완료 후 변경사항 요약

### 5단계: 재검토 (선택)
- 수정 완료 후 사용자에게 재검토 여부 확인
- 재검토 선택 시 1단계부터 다시 수행
- 이슈가 모두 해결될 때까지 반복 가능

### 6단계: 완료 안내
- 리뷰 완료 메시지 출력
- 다음 단계 안내: `/pr-create` 사용 권장
- 수정된 파일 목록 요약

## 주의사항
- **커밋하지 않음**: 이 커맨드는 코드만 수정하고 커밋은 하지 않음
- **사용자 확인 필수**: 자동으로 수정하지 않고 항상 사용자 승인 필요
- **보수적 접근**: 확실한 이슈만 지적하고, 주관적인 의견은 Info로 분류
- **비즈니스 로직 존중**: 기술적 이슈에 집중, 비즈니스 결정은 사용자에게 맡김

## 사용 예시
```
# 1. 코드 작성 완료 후
/pr-review

# 2. 리뷰 결과 확인 및 수정
# (대화형으로 진행)

# 3. 리뷰 통과 후 PR 생성
/pr-create
```

## 워크플로우 연계
```
코드 작성 → /pr-review (1차 셀프 리뷰) → /pr-create (PR 생성) → /pr-feedback (팀원 리뷰 반영)
```

## 관련 커맨드
- `/pr-create`: PR 생성 워크플로우 자동화
- `/pr-feedback`: PR 리뷰 코멘트 처리 자동화
